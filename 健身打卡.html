<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>8å¤©å¥èº«æ‰“å¡</title>
  <link rel="manifest" href="data:application/manifest+json;base64,ewogICJuYW1lIjogIuW9j+WwveS4ieWKmSIsCiAgInNob3J0X25hbWUiOiAi5o6Y6K-35YqbIiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNmNGY3ZjkiLAogICJ0aGVtZV9jb2xvciI6ICIjMjE5NkYzIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiaHR0cHM6Ly9leGFtcGxlLmNvbS9pY29uLTE5Mi5wbmciLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3BuZyIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiaHR0cHM6Ly9leGFtcGxlLmNvbS9pY29uLTUxMi5wbmciLAogICAgICAic2l6ZXMiOiAiNTEyeDUxMiIsCiAgICAgICJ0eXBlIjogImltYWdlL3BuZyIKICAgIH0KICBdCn0=">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ’ª</text></svg>">
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <style>
    :root { --primary: #4CAF50; --accent: #2196F3; --bg: #f4f7f9; --card: white; --text: #333; }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 20px; line-height: 1.6; }
    .container { max-width: 800px; margin: auto; }
    h1 { text-align: center; color: var(--accent); margin-bottom: 10px; }
    .subtitle { text-align: center; color: #666; font-size: 0.9em; margin-bottom: 20px; }

    .cycle-info { background: var(--card); padding: 15px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; margin-bottom: 20px; font-weight: bold; }
    .progress-bar { height: 10px; background: #e0e0e0; border-radius: 5px; overflow: hidden; margin: 10px 0; }
    .progress { height: 100%; background: var(--primary); width: 0%; transition: width 0.4s; }

    .days { display: grid; gap: 12px; margin-bottom: 20px; }
    .day-card { background: var(--card); border-radius: 12px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .day-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .day-title { font-weight: bold; font-size: 1.1em; }
    .day-type { font-size: 0.8em; padding: 2px 8px; border-radius: 20px; color: white; }
    .type-strength { background: #FF5722; }
    .type-cardio { background: var(--accent); }
    .type-rest { background: #9E9E9E; }
    .day-content { font-size: 0.9em; color: #555; margin: 8px 0; }
    .btn-group { display: flex; gap: 8px; }
    .complete-btn, .skip-btn { flex: 1; padding: 8px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
    .complete-btn { background: #ddd; }
    .complete-btn.completed { background: var(--primary); color: white; }
    .complete-btn.completed::after { content: " âœ“"; }
    .skip-btn { background: #ff9800; color: white; }

    .tab-btn { display: block; margin: 10px auto; padding: 12px 24px; background: var(--accent); color: white; border: none; border-radius: 8px; cursor: pointer; }
    .share-btn { background: #25D366; } /* å¾®ä¿¡ç»¿ */
    .reset-btn { background: #f44336; }

    .history { display: none; background: var(--card); padding: 16px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .history h3 { margin-bottom: 12px; color: var(--accent); }
    .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 16px; font-weight: bold; }
    .cycle-list { font-size: 0.9em; }
    .cycle-item { padding: 8px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; }
    .cycle-item:last-child { border-bottom: none; }

    @media (max-width: 600px) { body { padding: 10px; } }
  </style>
</head>
<body>

<div class="container">
  <h1>8å¤©å¥èº«æ‰“å¡</h1>

  <!-- ä¸»é¡µ -->
  <div id="main-view">
    <div class="cycle-info">
      å½“å‰å‘¨æœŸï¼šç¬¬ <span id="cycle-num">1</span> å‘¨æœŸ  
      <div class="progress-bar"><div id="progress" class="progress"></div></div>
      <span id="progress-text">0/8 å¤©å®Œæˆ</span>
    </div>

    <div class="days" id="days-container"></div>

    <button class="tab-btn share-btn" onclick="shareScreenshot()">ğŸ“¸ åˆ†äº«æˆªå›¾</button>
    <button class="tab-btn" onclick="showHistory()">ğŸ“Š æŸ¥çœ‹å†å²è®°å½•</button>
    <button class="tab-btn reset-btn" onclick="resetCycle()">ğŸ”„ é‡ç½®æœ¬å‘¨æœŸ</button>
  </div>

  <!-- å†å²é¡µ -->
  <div id="history-view" class="history">
    <h3>ğŸ“ˆ åšæŒè®°å½•</h3>
    <div class="stats">
      <div>æ€»åšæŒå¤©æ•°ï¼š<span id="total-days">0</span> å¤©</div>
      <div>å®Œæˆå‘¨æœŸï¼š<span id="completed-cycles">0</span> ä¸ª</div>
    </div>
    <div class="cycle-list" id="cycle-list"></div>
    <button class="tab-btn share-btn" onclick="shareScreenshot()">ğŸ“¸ åˆ†äº«æˆªå›¾</button>
    <button class="tab-btn" onclick="showMain()">â¬…ï¸ è¿”å›æ‰“å¡</button>
  </div>
</div>

<script>
  const plan = [
    { type: "strength", title: "Day 1 - èƒŒ + äºŒå¤´", content: "èƒŒéƒ¨ 3 åŠ¨ä½œ<br>æ™®é€šå¼¯ä¸¾ 3Ã—8â€“12<br>é”¤å¼å¼¯ä¸¾ 3Ã—10â€“15" },
    { type: "cardio", title: "Day 2 - æœ‰æ°§ + æ ¸å¿ƒ", content: "å…¬è·¯è½¦ ä¸­ç­‰å¼ºåº¦ 1å°æ—¶<br>å·è…¹ + å¹³æ¿æ”¯æ’‘ 10 min" },
    { type: "strength", title: "Day 3 - è‚© + ä¸‰å¤´", content: "è‚©éƒ¨ 3 åŠ¨ä½œ<br>è¿‡é¡¶è‡‚å±ˆä¼¸ 3Ã—8â€“12" },
    { type: "cardio", title: "Day 4 - æœ‰æ°§ + æ ¸å¿ƒ", content: "å…¬è·¯è½¦ ä½å¼ºåº¦ 45â€“60 min + æ‹‰ä¼¸<br>å·è…¹ + å¹³æ¿æ”¯æ’‘ 10 min" },
    { type: "strength", title: "Day 5 - èƒ¸ + ä¸‰å¤´", content: "èƒ¸éƒ¨ 4 åŠ¨ä½œ<br>è¿‡é¡¶è‡‚å±ˆä¼¸ 3Ã—8â€“12" },
    { type: "cardio", title: "Day 6 - æœ‰æ°§ + æ ¸å¿ƒ", content: "æ…¢è·‘ 5kmï¼ˆ6:30â€“7:30/kmï¼‰<br>å·è…¹ + å¹³æ¿æ”¯æ’‘ 10 min" },
    { type: "strength", title: "Day 7 - è…¿ + äºŒå¤´ + å‰è‡‚", content: "è…¿éƒ¨ 5 åŠ¨ä½œ<br>é”¤å¼å¼¯ä¸¾ 3Ã—10â€“15<br>åå‘å¼¯ä¸¾ 3Ã—12â€“15" },
    { type: "rest", title: "Day 8 - ä¼‘æ¯æ—¥", content: "å®Œå…¨ä¼‘æ¯ / æ•£æ­¥ / ç‘œä¼½<br>äº«å—æ¢å¤ï¼" }
  ];

  const STORAGE_KEY = 'fitness_checkin_v5';
  let data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
    currentCycle: 1,
    currentDayIndex: 0,
    cycles: {}
  };

  function init() {
    ensureCurrentCycle();
    renderMain();
  }

  function ensureCurrentCycle() {
    const c = data.currentCycle;
    if (!data.cycles[c]) {
      data.cycles[c] = { start: getToday(), days: {} };
    }
  }

  function getToday() {
    return new Date().toISOString().split('T')[0];
  }

  function renderMain() {
    document.getElementById('main-view').style.display = 'block';
    document.getElementById('history-view').style.display = 'none';
    document.getElementById('cycle-num').textContent = data.currentCycle;

    const container = document.getElementById('days-container');
    container.innerHTML = '';
    const today = plan[data.currentDayIndex];
    const tomorrow = plan[(data.currentDayIndex + 1) % 8];

    [today, tomorrow].forEach((day, i) => {
      const dayNum = ((data.currentDayIndex + i) % 8) + 1;
      const isToday = i === 0;
      const record = data.cycles[data.currentCycle].days[dayNum];
      const isCompleted = !!record;

      const card = document.createElement('div');
      card.className = 'day-card';
      const typeText = day.type === 'strength' ? 'åŠ›é‡' : day.type === 'cardio' ? 'æœ‰æ°§' : 'ä¼‘æ¯';
      const typeClass = `day-type type-${day.type}`;
      const prefix = isToday ? 'ä»Šå¤©' : 'æ˜å¤©';

      card.innerHTML = `
        <div class="day-header">
          <span class="day-title">${prefix} ${day.title}</span>
          <span class="${typeClass}">${typeText}</span>
        </div>
        <div class="day-content">${day.content}</div>
        <div class="btn-group">
          <button class="complete-btn ${isCompleted ? 'completed' : ''}" 
                  onclick="completeToday()" ${day.type === 'rest' ? 'disabled' : ''}>
            ${isCompleted ? 'å·²å®Œæˆ' : 'å®Œæˆè®­ç»ƒ'}
          </button>
          <button class="skip-btn" onclick="skipToday()" ${!isToday || day.type === 'rest' ? 'disabled' : ''}>
            è·³è¿‡ä»Šå¤©
          </button>
        </div>
      `;
      if (day.type === 'rest') {
        card.querySelector('.complete-btn').classList.add('completed');
        card.querySelector('.complete-btn').textContent = 'è‡ªåŠ¨å®Œæˆ';
      }
      if (isCompleted && record) {
        const btn = card.querySelector('.complete-btn');
        btn.innerHTML = `å·²å®Œæˆ<br><small>${record}</small>`;
      }
      container.appendChild(card);
    });
    updateProgress();
  }

  function completeToday() {
    const dayNum = (data.currentDayIndex % 8) + 1;
    const today  = getToday();
    data.cycles[data.currentCycle].days[dayNum] = today;
    saveData();
    nextDay();
  }

  function skipToday() {
    if (confirm('è·³è¿‡ä»Šå¤©ï¼Ÿæ˜å¤©ç»§ç»­åŸè®¡åˆ’')) {
      nextDay();
    }
  }

  function nextDay() {
    data.currentDayIndex = (data.currentDayIndex + 1) % 8;
    saveData();
    renderMain();

    if (data.currentDayIndex === 0) {
      setTimeout(() => {
        if (confirm('æœ¬å‘¨æœŸå®Œæˆï¼è¿›å…¥ä¸‹ä¸€å‘¨æœŸï¼Ÿ')) {
          const c = data.currentCycle;
          data.cycles[c].end = getToday();
          data.currentCycle++;
          data.currentDayIndex = 0;
          data.cycles[data.currentCycle] = { start: getToday(), days: {} };
          saveData();
          renderMain();
        }
      }, 300);
    }
  }

  function updateProgress() {
    const c = data.currentCycle;
    const completed = Object.keys(data.cycles[c].days).length;
    const percent = (completed / 8) * 100;
    document.getElementById('progress').style.width = percent + '%';
    document.getElementById('progress-text').textContent = `${completed}/8 å¤©å®Œæˆ`;
  }

  function showHistory() {
    document.getElementById('main-view').style.display = 'none';
    document.getElementById('history-view').style.display = 'block';

    const list = document.getElementById('cycle-list');
    list.innerHTML = '';
    let totalDays = 0;
    let completedCycles = 0;

    Object.keys(data.cycles).sort((a,b)=>b-a).forEach(cycle => {
      const info = data.cycles[cycle];
      const days = Object.keys(info.days).length;
      if (info.end) completedCycles++;
      totalDays += days;

      const item = document.createElement('div');
      item.className = 'cycle-item';
      item.innerHTML = `
        <span>ç¬¬ ${cycle} å‘¨æœŸ</span>
        <span>${info.start} â†’ ${info.end || 'è¿›è¡Œä¸­'} (${days}/8 å¤©)</span>
      `;
      list.appendChild(item);
    });

    document.getElementById('total-days').textContent = totalDays;
    document.getElementById('completed-cycles').textContent = completedCycles;
  }

  function showMain() {
    document.getElementById('history-view').style.display = 'none';
    document.getElementById('main-view').style.display = 'block';
  }

  function resetCycle() {
    if (confirm('é‡ç½®æœ¬å‘¨æœŸï¼Ÿ')) {
      const c = data.currentCycle;
      delete data.cycles[c];
      data.currentDayIndex = 0;
      data.cycles[c] = { start: getToday(), days: {} };
      saveData();
      renderMain();
    }
  }

  // === å¾®ä¿¡å¯ç”¨çš„æˆªå›¾åŠŸèƒ½ ===
async function shareScreenshot() {
  const element = document.querySelector('.container');

  try {
    const canvas = await html2canvas(element, { scale: 2, useCORS: true });

    // è½¬æˆ base64
    const dataUrl = canvas.toDataURL("image/png");

    // åˆ›å»ºä¸€ä¸ªå…¨å±é®ç½©å±‚æ˜¾ç¤ºå›¾ç‰‡ï¼Œä¾›å¾®ä¿¡é•¿æŒ‰ä¿å­˜
    const overlay = document.createElement('div');
    overlay.style.position = 'fixed';
    overlay.style.top = 0;
    overlay.style.left = 0;
    overlay.style.width = '100%';
    overlay.style.height = '100%';
    overlay.style.background = 'rgba(0,0,0,0.8)';
    overlay.style.display = 'flex';
    overlay.style.justifyContent = 'center';
    overlay.style.alignItems = 'center';
    overlay.style.zIndex = 9999;
    overlay.onclick = () => document.body.removeChild(overlay);

    const img = document.createElement('img');
    img.src = dataUrl;
    img.style.maxWidth = '90%';
    img.style.maxHeight = '90%';
    img.style.borderRadius = '12px';

    overlay.appendChild(img);
    document.body.appendChild(overlay);

    alert("é•¿æŒ‰å›¾ç‰‡å³å¯ä¿å­˜åˆ°ç›¸å†Œï¼");
  } catch (e) {
    alert("æˆªå›¾å¤±è´¥ï¼Œè¯·é‡è¯•");
  }
}


  function saveData() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }

  window.onload = init;
</script>

</body>
</html>